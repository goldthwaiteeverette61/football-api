<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.dromara.biz.mapper.BizUsersMapper">
    <!--
        扣除余额 (原子操作)
        通过在WHERE条件中检查余额，确保不会超额扣款。
        如果余额不足，UPDATE语句将不会匹配到任何行，返回的受影响行数为0。
    -->
    <update id="deductBalance">
        UPDATE biz_users
        SET balance = balance - #{amount}
        WHERE user_id = #{userId} AND balance >= #{amount}
    </update>

    <!--
        增加余额 (原子操作)
    -->
    <update id="addBalance">
        UPDATE biz_users
        SET balance = balance + #{amount}
        WHERE user_id = #{userId}
    </update>

</mapper>
